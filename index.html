// 音声をロードして選択肢を作成
function loadVoices() {
    voices = window.speechSynthesis.getVoices();
    
    if (voices.length === 0) {
        setTimeout(loadVoices, 100); // 100ms後に再試行
        return;
    }

    const voiceSelect = document.getElementById("voiceSelect");
    voiceSelect.innerHTML = '';

    // 日本語対応の音声のみをフィルタリング
    const japaneseVoices = voices.filter(voice => voice.lang.includes('ja'));

    // 日本語の音声が見つからなかった場合の対策
    if (japaneseVoices.length === 0) {
        const option = document.createElement("option");
        option.textContent = "日本語対応の音声が見つかりません";
        option.disabled = true;
        voiceSelect.appendChild(option);
        return;
    }

    // 日本語対応の音声を選択肢に追加
    japaneseVoices.forEach(voice => {
        const option = document.createElement("option");
        option.textContent = voice.name;
        option.value = voice.name;
        voiceSelect.appendChild(option);
    });

    // デフォルトで最初の日本語音声を選択
    voiceSelect.value = japaneseVoices[0].name;
}

// テキストを読み上げる
function speakText() {
    const text = document.getElementById("text").value;
    if (text === '') {
        alert("テキストを入力してください");
        return;
    }

    const speech = new SpeechSynthesisUtterance(text);
    
    // 声の選択
    const selectedVoiceName = document.getElementById("voiceSelect").value;
    const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
    speech.voice = selectedVoice;

    // 音声の設定
    speech.lang = 'ja-JP';
    speech.rate = 1;
    speech.volume = 1;
    speech.pitch = 1.2;

    // 音声を再生
    window.speechSynthesis.speak(speech);
}

// 音声が変更されたときにリストを更新
window.speechSynthesis.onvoiceschanged = loadVoices;

// 初期ロード時に音声リストをロード
setTimeout(loadVoices, 100);
